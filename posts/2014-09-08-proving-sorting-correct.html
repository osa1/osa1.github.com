<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>osa1 - Proving sorting algorithms correct</title>
        <link href="http://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Monda" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/coqpost.css" />

        <link rel="alternate" type="application/rss+xml" title="osa1.net blog" href="../rss.xml" />
    </head>
    <body>
        <div id="column">
            <div id="header-inner">
                <span id="blog-title"><a href="../">osa1</a></span>
                <span id="feed"><a href="../rss.xml">feed</a></span>
            </div>
            <div class="inner">
                <h1 id="post-title">Proving sorting algorithms correct</h1>

<p><strong>September  8, 2014</strong> - Tagged as: <a href="../tags/coq.html">coq</a>, <a href="../tags/en.html">en</a>.</p>

<div class="code">
</div>

<div class="doc">

<div class="paragraph"> </div>

I've been working on proving some sorting algorithms correct in Coq. After 600 lines of Coq proofs, I managed to prove correctness of <a href="http://en.wikipedia.org/wiki/Insertion_sort">insertion sort</a>, <a href="http://en.wikipedia.org/wiki/Selection_sort">selection sort</a>, and a weird sorting algorithm called <a href="http://austingwalters.com/everyday-algorithms-pancake-sort/">pancake sort</a>. This post is a <a href="https://github.com/osa1/blog/blob/master/theories/SortingCorrect.v">literate Coq file</a> which you can download and execute in a Coq IDE, step by step. To keep the post shorter and easier to read and make it more like an exercise, I hided most of the proofs in HTML version.

<div class="paragraph"> </div>

Goals of this post are:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Provide some guidance for starters who are interested in proving algorithms correct.

</li>
<li> Demonstrate how to prove properties of functions with accumulators and functions that work on list indexes, instead of elements of the list.

</li>
<li> Demonstrate how to use "timeout" arguments to convince Coq that a function is really terminating on all inputs.

</li>
</ul>
A note before starting: I deliberately ignored advanced proof automation tools and go with more primitive way of proving. This is for two reasons: 1) I don't like magic, and since I don't understand underlying mechanics of advanced proofs tactics like <span class="inlinecode"><span class="id" title="var">crush</span></span>, it's magic to me 2) They're sometimes so powerful, they get in your way to understand what's really happening in the proof.

<div class="paragraph"> </div>

If you're reading this post as an exercise and filling the proofs yourself, that should not be a problem for you. Otherwise you may find my proofs more verbose than what's necessary.

<div class="paragraph"> </div>

Let's start with standard stuff: imports. These are for some list helpers, list syntax, Peano definitions + functions etc. Just standard stuff. Only exception is the <span class="inlinecode"><span class="id" title="var">Permutation</span></span> library, which I'll soon explain why it's necessary.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br />
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br />
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">list_scope</span>.<br />
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Arith.Arith.html#"><span class="id" title="library">Arith</span></a>.<br />
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.omega.Omega.html#"><span class="id" title="library">Omega</span></a>.<br />
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#"><span class="id" title="library">Permutation</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Our goal is to define some sorting algorithms and then prove them correct, but for that we first need to define what we mean by for a sorting algorithm to be "correct". For some functions definition of correctness may be tricky to give, but in the context of sorting I think it's obvious:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Result should be a permutation of it's parameter.

</li>
<li> Result should be in sorted order.

</li>
</ul>
Definition of a "permutation" is defined in the <span class="inlinecode"><span class="id" title="var">Permutation</span></span> library we've just included, and it comes with lots of very useful lemmas. I suggest you to go to <span class="inlinecode"><span class="id" title="var">Permutation</span></span> library's documentation(you can go to the docs by clicking <span class="inlinecode"><span class="id" title="var">Permutation</span></span> link in the imports part above) and just skim through the definition and lemmas, and convince yourself that the definition is really enough to show that two lists are really a permutation.

<div class="paragraph"> </div>

For being sorted, we need to define what does that mean.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Inductive</span> <a name="sorted"><span class="id" title="inductive">sorted</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> → <span class="id" title="keyword">Prop</span> :=<br />
| <a name="Sorted_nil"><span class="id" title="constructor">Sorted_nil</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a><br />
| <a name="Sorted_singleton"><span class="id" title="constructor">Sorted_singleton</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#ca01241a0c3f7016e6e2a252e5d50788"><span class="id" title="notation">[</span></a><a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#ca01241a0c3f7016e6e2a252e5d50788"><span class="id" title="notation">]</span></a><br />
| <a name="Sorted_cons"><span class="id" title="constructor">Sorted_cons</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>) → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Again, convince yourself that <span class="inlinecode"><span class="id" title="var">sorted</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> really encodes what we intuitively know about being sorted. Main property that should hold for any <span class="inlinecode"><span class="id" title="var">l</span></span> that is <span class="inlinecode"><span class="id" title="var">sorted</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> is that for any consecutive elements <span class="inlinecode"><span class="id" title="var">a</span></span> and <span class="inlinecode"><span class="id" title="var">b</span></span> in the list, <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">b</span></span> should hold, which our third constructor shows.

<div class="paragraph"> </div>

Using <span class="inlinecode"><span class="id" title="var">Permutation</span></span> and <span class="inlinecode"><span class="id" title="var">sorted</span></span>, we can define what does being correct for a sorting algorithm mean:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Inductive</span> <a name="Sorting_correct"><span class="id" title="inductive">Sorting_correct</span></a> (<span class="id" title="var">algo</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br />
| <a name="sorting_correct_intro"><span class="id" title="constructor">sorting_correct_intro</span></a> :<br />
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<span class="id" title="var">algo</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<span class="id" title="var">algo</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>)) → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" title="inductive">Sorting_correct</span></a> <span class="id" title="var">algo</span>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Note that in both definition of <span class="inlinecode"><span class="id" title="var">sorted</span></span> and <span class="inlinecode"><span class="id" title="var">Sorting_correct</span></span>, we used list of nats instead of any lists of ordered elements. This is really just to make definitions and proofs simpler. Generalization may be done as an exercise.

<div class="paragraph"> </div>

Now with those definitions, we can prove our first and easiest-to-prove algorithm.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a name="lab1"></a><h2 class="section">Insertion sort</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

We define insertion sort as a right fold:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Fixpoint</span> <a name="insert"><span class="id" title="definition">insert</span></a> (<span class="id" title="var">i</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a>     ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#ca01241a0c3f7016e6e2a252e5d50788"><span class="id" title="notation">[</span></a><a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#ca01241a0c3f7016e6e2a252e5d50788"><span class="id" title="notation">]</span></a><br />
&nbsp;&nbsp;| <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Arith.Compare_dec.html#leb"><span class="id" title="definition">leb</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">h</span> <span class="id" title="keyword">then</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> <span class="id" title="keyword">else</span> <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">t</span><br />
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br />

<br />
<span class="id" title="keyword">Definition</span> <a name="insertion_sort"><span class="id" title="definition">insertion_sort</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#fold_right"><span class="id" title="definition">fold_right</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now if we could show that <span class="inlinecode"><span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> on list <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" title="var">t</span></span> returns a permutation, we could easily show that insertion sort returns a permutation, because all it does is to call <span class="inlinecode"><span class="id" title="var">insert</span></span> on list elements, using <span class="inlinecode"><span class="id" title="var">fold_right</span></span>.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="insert_perm"><span class="id" title="lemma">insert_perm</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>) (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use <span class="inlinecode"><span class="id" title="var">insert_perm</span></span> and transitivity, symmetry and reflexivity of <span class="inlinecode"><span class="id" title="var">Permutation</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="Permutation_insertion_sort"><span class="id" title="lemma">Permutation_insertion_sort</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort"><span class="id" title="definition">insertion_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

To show that it returns sorted, we use a similar approach. We first show that if <span class="inlinecode"><span class="id" title="var">sorted</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span>, then <span class="inlinecode"><span class="id" title="var">sorted</span></span> <span class="inlinecode">(<span class="id" title="var">insert</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">l</span>)</span>. Empty and singleton lists are sorted by definition. Using these facts, we can easily prove that insertion sort really return sorted.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 star. You need to use some lemmas about <span class="inlinecode"><span class="id" title="var">leb</span></span> that are already included. Use <span class="inlinecode"><span class="id" title="keyword">SearchAbout</span></span> <span class="inlinecode"><span class="id" title="var">leb</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="insert_sorted_preserve"><span class="id" title="lemma">insert_sorted_preserve</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 star. Use <span class="inlinecode"><span class="id" title="var">insert_sorted_preserve</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="insertion_sort_sorted"><span class="id" title="lemma">insertion_sort_sorted</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort"><span class="id" title="definition">insertion_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

With permutation and sorted properties proved, we can show that our insertion sort implementation is correct:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Theorem</span> <a name="insertion_sort_correct"><span class="id" title="lemma">insertion_sort_correct</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" title="inductive">Sorting_correct</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort"><span class="id" title="definition">insertion_sort</span></a>.<br />
<span class="id" title="keyword">Proof</span>.<br />
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort_sorted"><span class="id" title="lemma">insertion_sort_sorted</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Permutation_insertion_sort"><span class="id" title="lemma">Permutation_insertion_sort</span></a>.<br />
<span class="id" title="keyword">Qed</span>.<br />

<br />
</div>

<div class="doc">
<a name="lab2"></a><h2 class="section">Selection sort</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

Next, we move to selection sort. This one is significantly harder and most stuff we define in this section will be used in the next section.

<div class="paragraph"> </div>

Before implementing the algorithm, we need some auxiliary functions. <span class="inlinecode"><span class="id" title="var">find_min_idx</span></span> is both used in selection sort and pancake sort. As you can imagine from the name, it returns index of one of the smallest elements in a list.

<div class="paragraph"> </div>

Note that it's very very hard to reason about this definition. The reason is that we're using index of a list, instead of head/tail of it. Simple induction-based proofs that we do before simply don't work on this definition.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Fixpoint</span> <a name="find_min_idx_aux"><span class="id" title="definition">find_min_idx_aux</span></a> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<span class="id" title="var">min</span> <span class="id" title="var">min_idx</span> <span class="id" title="var">cur_idx</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a>     ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" title="variable">min_idx</span></a><br />
&nbsp;&nbsp;| <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Arith.Compare_dec.html#leb"><span class="id" title="definition">leb</span></a> <span class="id" title="var">h</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min"><span class="id" title="variable">min</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" title="definition">find_min_idx_aux</span></a> <span class="id" title="var">t</span> <span class="id" title="var">h</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#cur_idx"><span class="id" title="variable">cur_idx</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#cur_idx"><span class="id" title="variable">cur_idx</span></a>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" title="definition">find_min_idx_aux</span></a> <span class="id" title="var">t</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min"><span class="id" title="variable">min</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" title="variable">min_idx</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#cur_idx"><span class="id" title="variable">cur_idx</span></a>)<br />
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br />

<br />
<span class="id" title="keyword">Definition</span> <a name="find_min_idx"><span class="id" title="definition">find_min_idx</span></a> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a>     ⇒ 0<br />
&nbsp;&nbsp;| <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" title="definition">find_min_idx_aux</span></a> <span class="id" title="var">t</span> <span class="id" title="var">h</span> 0 1<br />
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

An invariant of <span class="inlinecode"><span class="id" title="var">find_min_idx</span></span>:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="find_min_idx_len_inv"><span class="id" title="lemma">find_min_idx_len_inv</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">m</span> <span class="id" title="var">mi</span> <span class="id" title="var">ci</span> <span class="id" title="var">r</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" title="definition">find_min_idx_aux</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#mi"><span class="id" title="variable">mi</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#ci"><span class="id" title="variable">ci</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#r"><span class="id" title="variable">r</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#mi"><span class="id" title="variable">mi</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#ci"><span class="id" title="variable">ci</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#r"><span class="id" title="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#ci"><span class="id" title="variable">ci</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#b3eea360671e1b32b18a26e15b3aace3"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Make sure you understand what it's saying. We need this lemma to eliminate some impossible cases in proofs.

<div class="paragraph"> </div>

We also need a "membership" predicate. This is used to express the idea of "for all elements in the list ...", which is expressed in Coq like <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">e</span>,</span> <span class="inlinecode"><span class="id" title="var">member</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode">→</span> <span class="inlinecode">...</span>.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Inductive</span> <a name="member"><span class="id" title="inductive">member</span></a> {<span class="id" title="var">A</span>} : <span class="id" title="var">A</span> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span> :=<br />
| <a name="Member_head"><span class="id" title="constructor">Member_head</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>)<br />
| <a name="Member_tail"><span class="id" title="constructor">Member_tail</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">e</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Again, convince yourself that this really expresses that idea. Here's a property of member:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="member_preserved_by_perm"><span class="id" title="lemma">member_preserved_by_perm</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) <span class="id" title="var">l&acute;</span> <span class="id" title="var">e</span>,<br />
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now using <span class="inlinecode"><span class="id" title="var">member</span></span>, we can express correctness of <span class="inlinecode"><span class="id" title="var">find_min_idx</span></span> and prove it. Note that this is a very hard exercise. I couldn't solve it for a week, and even after that period I couldn't solve it without help from Coq IRC channel. Feel free to cheat by looking the source of this post.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
</div>

<div class="doc">
***** Exercise: 5 stars. <span class="inlinecode"><span class="id" title="var">find_min_idx</span></span> really returns index of smallest element. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="find_min_idx_correct"><span class="id" title="lemma">find_min_idx_correct</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx"><span class="id" title="definition">find_min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now, in selection sort, we run several operations on argument. One of them is <span class="inlinecode"><span class="id" title="var">find_min_idx</span></span> which we already defined. Another one of them is <span class="inlinecode"><span class="id" title="tactic">replace</span></span> operation, which replaces nth element in a list with given element. Here's a definition and some properties:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Fixpoint</span> <a name="replace"><span class="id" title="definition">replace</span></a> {<span class="id" title="var">A</span>} (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">idx</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<span class="id" title="var">e</span> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a> :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a><br />
&nbsp;&nbsp;| <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#idx"><span class="id" title="variable">idx</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">idx&acute;</span> ⇒ <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" title="definition">replace</span></a> <span class="id" title="var">t</span> <span class="id" title="var">idx&acute;</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br />
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. First part of correctness proof of <span class="inlinecode"><span class="id" title="tactic">replace</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="replace_nth"><span class="id" title="lemma">replace_nth</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">l&acute;</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" title="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a>.<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. Second part of correctness proof of <span class="inlinecode"><span class="id" title="tactic">replace</span></span>. <span class="inlinecode"><span class="id" title="tactic">replace</span></span> preserves length of the list. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="replace_len"><span class="id" title="lemma">replace_len</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> <span class="id" title="var">l</span> <span class="id" title="var">i</span> (<span class="id" title="var">e</span> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>),<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" title="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Using <span class="inlinecode"><span class="id" title="tactic">replace</span></span>, we can define <span class="inlinecode"><span class="id" title="var">selection_sort</span></span>. Note that our naive implementation doesn't convince Coq that it terminates on all input. An easy workaround is to add a <span class="inlinecode"><span class="id" title="var">step</span></span> parameter. Observing that selection sort algorithm terminates in <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> steps, where <span class="inlinecode"><span class="id" title="var">l</span></span> is the input, we can define this:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Fixpoint</span> <a name="selection_sort_aux"><span class="id" title="definition">selection_sort_aux</span></a> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<span class="id" title="var">step</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#step"><span class="id" title="variable">step</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;| 0       ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a><br />
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">step&acute;</span> ⇒<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a>     ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" title="definition">find_min_idx_aux</span></a> <span class="id" title="var">t</span> <span class="id" title="var">h</span> 0 1 <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0     ⇒ <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort_aux"><span class="id" title="definition">selection_sort_aux</span></a> <span class="id" title="var">t</span> <span class="id" title="var">step&acute;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">min</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <span class="id" title="var">min</span> <span class="id" title="var">t</span> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort_aux"><span class="id" title="definition">selection_sort_aux</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" title="definition">replace</span></a> <span class="id" title="var">t</span> <span class="id" title="var">min</span> <span class="id" title="var">h</span>) <span class="id" title="var">step&acute;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br />
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br />

<br />
<span class="id" title="keyword">Definition</span> <a name="selection_sort"><span class="id" title="definition">selection_sort</span></a> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort_aux"><span class="id" title="definition">selection_sort_aux</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

We have all we need to prove permutation property. It's still not easy though. I'm putting an extra lemma here as a tip.

</div>
<div class="code">

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="replace_perm_head"><span class="id" title="lemma">replace_perm_head</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" title="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 3 stars. Use <span class="inlinecode"><span class="id" title="var">replace_perm_head</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="Permutation_selection_sort"><span class="id" title="lemma">Permutation_selection_sort</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort"><span class="id" title="definition">selection_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Proving sorted property is again, not easy. I'm putting some lemmas as pointers. Lemmas are very easy to prove, leaving only the master theorem as a challange.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="member_replace"><span class="id" title="lemma">member_replace</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> <span class="id" title="var">l</span> <span class="id" title="var">i</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>),<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" title="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#y"><span class="id" title="variable">y</span></a>) →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#7a45dffb109c3069e5c675be68643e60"><span class="id" title="notation">∨</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>.<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use <span class="inlinecode"><span class="id" title="var">member_replace</span></span> and <span class="inlinecode"><span class="id" title="var">find_min_idx_correct</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="swap_min_replace"><span class="id" title="lemma">swap_min_replace</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span> <span class="id" title="var">min_idx</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx"><span class="id" title="definition">find_min_idx</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" title="variable">min_idx</span></a> →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" title="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" title="variable">min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a>) → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" title="variable">min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="sorted_min_tail"><span class="id" title="lemma">sorted_min_tail</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a>) →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use <span class="inlinecode"><span class="id" title="var">member_preserved_by_perm</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="min_preserved_by_perm"><span class="id" title="lemma">min_preserved_by_perm</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">m</span> <span class="id" title="var">l</span> <span class="id" title="var">l&acute;</span>,<br />
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a> →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a>) →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 4 stars. Selection sort returns sorted. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="selection_sort_sorted"><span class="id" title="lemma">selection_sort_sorted</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort"><span class="id" title="definition">selection_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. Show that selection sort is correct. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="selection_sort_correct"><span class="id" title="lemma">selection_sort_correct</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" title="inductive">Sorting_correct</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort"><span class="id" title="definition">selection_sort</span></a>.<br />

<br />
</div>

<div class="doc">
<a name="lab3"></a><h2 class="section">Pancake sort</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

This is getting harder and harder. We'll define pancake sort in terms of <span class="inlinecode"><span class="id" title="var">rev_at</span></span> which reverses a list at given index and <span class="inlinecode"><span class="id" title="var">map_rest</span></span> which is like <span class="inlinecode"><span class="id" title="var">map</span></span>, but applies the function to the rest of the list.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Fixpoint</span> <a name="rev_at"><span class="id" title="definition">rev_at</span></a> {<span class="id" title="var">A</span>} <span class="id" title="var">idx</span> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a> :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#idx"><span class="id" title="variable">idx</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;| 0      ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#rev"><span class="id" title="definition">rev</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a><br />
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">idx&acute;</span> ⇒<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a>     ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" title="definition">rev_at</span></a> <span class="id" title="var">idx&acute;</span> <span class="id" title="var">t</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br />
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br />

<br />
<span class="id" title="keyword">Fixpoint</span> <a name="map_rest_aux"><span class="id" title="definition">map_rest_aux</span></a> {<span class="id" title="var">A</span>} (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">f</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">timeout</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a> :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#timeout"><span class="id" title="variable">timeout</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;| 0 ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a><br />
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">timeout&acute;</span> ⇒<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#145bedf8a5d4a541831f3f70db03085c"><span class="id" title="notation">[]</span></a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest_aux"><span class="id" title="definition">map_rest_aux</span></a> <span class="id" title="var">t</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" title="variable">f</span></a> <span class="id" title="var">timeout&acute;</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br />
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br />

<br />
<span class="id" title="keyword">Definition</span> <a name="map_rest"><span class="id" title="definition">map_rest</span></a> {<span class="id" title="var">A</span>} (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">f</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a> :=<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest_aux"><span class="id" title="definition">map_rest_aux</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" title="variable">f</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Two things to note: 1) <span class="inlinecode"><span class="id" title="var">rev_at</span></span> returns the original list if <span class="inlinecode"><span class="id" title="var">idx</span></span> is larger than <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode">-</span> <span class="inlinecode">1</span>. 2) <span class="inlinecode"><span class="id" title="var">map_rest</span></span> only works as expected if <span class="inlinecode"><span class="id" title="var">f</span></span> preserves length of it's argument in it's return value.

<div class="paragraph"> </div>

There's a very useful property that we need to show before showing that pancake sort returns a permutation: if <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> returns a permutation, than <span class="inlinecode"><span class="id" title="var">map_rest</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> returns a permutation:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 stars. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="Permutation_map_rest"><span class="id" title="lemma">Permutation_map_rest</span></a> :<br />
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> (<span class="id" title="var">f</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>),<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>)) →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest"><span class="id" title="definition">map_rest</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" title="variable">f</span></a>)).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Using this definition we can define pancake sort:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Definition</span> <a name="flip_pancakes"><span class="id" title="definition">flip_pancakes</span></a> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br />
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">min_idx</span> := <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx"><span class="id" title="definition">find_min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">in</span><br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" title="definition">rev_at</span></a> 0 (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" title="definition">rev_at</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" title="variable">min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
<span class="id" title="keyword">Definition</span> <a name="pancake_sort"><span class="id" title="definition">pancake_sort</span></a> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest"><span class="id" title="definition">map_rest</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" title="definition">flip_pancakes</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Showing permutation property is actually very easy. All we need is two simple lemmas:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 stars. Use already included standard permutation lemmas. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="Permutation_rev_at"><span class="id" title="lemma">Permutation_rev_at</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span> (<span class="id" title="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" title="variable">A</span></a>),<br />
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" title="definition">rev_at</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use transitivity of permutation and <span class="inlinecode"><span class="id" title="var">Permutation_rev_at</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="Permutation_flip_pancakes"><span class="id" title="lemma">Permutation_flip_pancakes</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" title="definition">flip_pancakes</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. Use <span class="inlinecode"><span class="id" title="var">Permutation_flip_pancakes</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="Permutation_pancake_sort"><span class="id" title="lemma">Permutation_pancake_sort</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sort"><span class="id" title="definition">pancake_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now the hard part. I needed a lot of lemmas for showing sorted property. I'm listing lemmas I used in no particular order.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 stars. Smallest element is still smallest in a permutation. I found this a bit tricky. You may need to use another lemma we defined. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="min_permutation"><span class="id" title="lemma">min_permutation</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">e</span> <span class="id" title="var">l</span>,<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e&acute;</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e&acute;"><span class="id" title="variable">e&acute;</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e&acute;"><span class="id" title="variable">e&acute;</span></a>) →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">l&acute;</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a> →<br />
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e&acute;</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e&acute;"><span class="id" title="variable">e&acute;</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l&acute;"><span class="id" title="variable">l&acute;</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e&acute;"><span class="id" title="variable">e&acute;</span></a>)).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. <span class="inlinecode"><span class="id" title="var">flip_pancakes</span></span> preserves the length. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="flip_pancakes_len"><span class="id" title="lemma">flip_pancakes_len</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" title="definition">flip_pancakes</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />

<br />
</div>

<div class="doc">
***** Exercise: 4 stars. We can use <span class="inlinecode"><span class="id" title="var">rev_at</span></span> to move smallest element to the end of the list, and then to the beginning of the list. Very tricky. Feel free to cheat. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="rev_at_n"><span class="id" title="lemma">rev_at_n</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" title="definition">rev_at</span></a> 0 (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" title="definition">rev_at</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" title="variable">t</span></a> →<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> 0.<br />

<br />

<br />
</div>

<div class="doc">
***** Exercise: 3 stars. <span class="inlinecode"><span class="id" title="var">flip_pancakes</span></span> moves smallest element to the head of the list. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="flip_pancakes_min"><span class="id" title="lemma">flip_pancakes_min</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">h&acute;</span> <span class="id" title="var">t&acute;</span>,<br />
&nbsp;&nbsp;<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" title="definition">flip_pancakes</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h&acute;"><span class="id" title="variable">h&acute;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t&acute;"><span class="id" title="variable">t&acute;</span></a> →<br />
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">e&acute;</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" title="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e&acute;"><span class="id" title="variable">e&acute;</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t&acute;"><span class="id" title="variable">t&acute;</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h&acute;"><span class="id" title="variable">h&acute;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e&acute;"><span class="id" title="variable">e&acute;</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 4 stars. You need a lot of lemmas we defined before, and it's a very long proof. Still not as hard as <span class="inlinecode"><span class="id" title="var">find_min_idx_correct</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="pancake_sorted"><span class="id" title="lemma">pancake_sorted</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sort"><span class="id" title="definition">pancake_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" title="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

And finally, our master theorem:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" title="keyword">Theorem</span> <a name="pancake_sort_correct"><span class="id" title="lemma">pancake_sort_correct</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" title="inductive">Sorting_correct</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sort"><span class="id" title="definition">pancake_sort</span></a>.<br />
<span class="id" title="keyword">Proof</span>.<br />
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sorted"><span class="id" title="lemma">pancake_sorted</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Permutation_pancake_sort"><span class="id" title="lemma">Permutation_pancake_sort</span></a>.<br />
<span class="id" title="keyword">Qed</span>.<br />

<br />
</div>

<div class="doc">
<a name="lab4"></a><h2 class="section">Notes and lessons learned</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

Implementation of algorithms are not what you'd expect to have in an imperative language. Rather than mutable arrays with O(1) access, I used classic functional style, using persistent linked lists. While that doesn't affect runtime asymptotic complexities of sorting algorithms I used, it causes a lot of redundant allocations and worse iteration performance. Even the OCaml/Haskell extractions are not usable.

<div class="paragraph"> </div>

Still, proving on those purely functional definitions were very hard. The reason is that once you move away from basic "induction of subterm" style proofs, proving gets very hard very fast. Specifically, I found working on indexes and accumulators very hard.

<div class="paragraph"> </div>

As a next step, I'm hoping to define an imperative language in Coq, like IMP of Software Foundations but with mutable arrays, and prove same algorithms defined in that language correct.

<div class="paragraph"> </div>


</div>
<div class="code">
</div>


<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'osa1';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

            </div>
        </div>
    </body>
</html>
