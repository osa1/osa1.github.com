<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>osa1 - Proving sorting algorithms correct</title>
        <link href="http://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Monda" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/coqpost.css" />

        <link rel="alternate" type="application/rss+xml" title="osa1.net blog" href="../rss.xml" />
    </head>
    <body>
        <div id="column">
            <div id="header-inner">
                <span id="blog-title"><a href="../">osa1</a></span>
                <span id="feed"><a href="../rss.xml">feed</a></span>
            </div>
            <div class="inner">
                <h1 id="post-title">Proving sorting algorithms correct</h1>

<p><strong>September  8, 2014</strong> - Tagged as: <a href="../tags/coq.html">coq</a>, <a href="../tags/en.html">en</a>.</p>

<div class="code">
</div>

<div class="doc">

<div class="paragraph"> </div>

I've been working on proving some sorting algorithms correct in Coq. After 600 lines of Coq proofs, I managed to prove correctness of <a href="http://en.wikipedia.org/wiki/Insertion_sort">insertion sort</a>, <a href="http://en.wikipedia.org/wiki/Selection_sort">selection sort</a>, and a weird sorting algorithm called <a href="http://austingwalters.com/everyday-algorithms-pancake-sort/">pancake sort</a>. This post is a <a href="https://github.com/osa1/blog/blob/master/theories/SortingCorrect.v">literate Coq file</a> which you can download and execute in a Coq IDE, step by step. To keep the post shorter and easier to read and make it more like an exercise, I hided most of the proofs in HTML version.

<div class="paragraph"> </div>

Goals of this post are:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Provide some guidance for starters who are interested in proving algorithms correct.

</li>
<li> Demonstrate how to prove properties of functions with accumulators and functions that work on list indexes, instead of elements of the list.

</li>
<li> Demonstrate how to use &quot;timeout&quot; arguments to convince Coq that a function is really terminating on all inputs.

</li>
</ul>
A note before starting: I deliberately ignored advanced proof automation tools and go with more primitive way of proving. This is for two reasons: 1) I don't like magic, and since I don't understand underlying mechanics of advanced proofs tactics like <span class="inlinecode"><span class="id" type="var">crush</span></span>, it's magic to me 2) They're sometimes so powerful, they get in your way to understand what's really happening in the proof.

<div class="paragraph"> </div>

If you're reading this post as an exercise and filling the proofs yourself, that should not be a problem for you. Otherwise you may find my proofs more verbose than what's necessary.

<div class="paragraph"> </div>

Let's start with standard stuff: imports. These are for some list helpers, list syntax, Peano definitions + functions etc. Just standard stuff. Only exception is the <span class="inlinecode"><span class="id" type="var">Permutation</span></span> library, which I'll soon explain why it's necessary.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#"><span class="id" type="library">List</span></a>.<br />
<span class="id" type="keyword">Import</span> <span class="id" type="var">ListNotations</span>.<br />
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">list_scope</span>.<br />
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Arith.Arith.html#"><span class="id" type="library">Arith</span></a>.<br />
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.omega.Omega.html#"><span class="id" type="library">Omega</span></a>.<br />
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#"><span class="id" type="library">Permutation</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Our goal is to define some sorting algorithms and then prove them correct, but for that we first need to define what we mean by for a sorting algorithm to be &quot;correct&quot;. For some functions definition of correctness may be tricky to give, but in the context of sorting I think it's obvious:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Result should be a permutation of it's parameter.

</li>
<li> Result should be in sorted order.

</li>
</ul>
Definition of a &quot;permutation&quot; is defined in the <span class="inlinecode"><span class="id" type="var">Permutation</span></span> library we've just included, and it comes with lots of very useful lemmas. I suggest you to go to <span class="inlinecode"><span class="id" type="var">Permutation</span></span> library's documentation(you can go to the docs by clicking <span class="inlinecode"><span class="id" type="var">Permutation</span></span> link in the imports part above) and just skim through the definition and lemmas, and convince yourself that the definition is really enough to show that two lists are really a permutation.

<div class="paragraph"> </div>

For being sorted, we need to define what does that mean.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Inductive</span> <a name="sorted"><span class="id" type="inductive">sorted</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> → <span class="id" type="keyword">Prop</span> :=<br />
| <a name="Sorted_nil"><span class="id" type="constructor">Sorted_nil</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a><br />
| <a name="Sorted_singleton"><span class="id" type="constructor">Sorted_singleton</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_x_';'_'..'_';'_x_']'"><span class="id" type="notation">[</span></a><a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_x_';'_'..'_';'_x_']'"><span class="id" type="notation">]</span></a><br />
| <a name="Sorted_cons"><span class="id" type="constructor">Sorted_cons</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>) → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Again, convince yourself that <span class="inlinecode"><span class="id" type="var">sorted</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span> really encodes what we intuitively know about being sorted. Main property that should hold for any <span class="inlinecode"><span class="id" type="var">l</span></span> that is <span class="inlinecode"><span class="id" type="var">sorted</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span> is that for any consecutive elements <span class="inlinecode"><span class="id" type="var">a</span></span> and <span class="inlinecode"><span class="id" type="var">b</span></span> in the list, <span class="inlinecode"><span class="id" type="var">a</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" type="var">b</span></span> should hold, which our third constructor shows.

<div class="paragraph"> </div>

Using <span class="inlinecode"><span class="id" type="var">Permutation</span></span> and <span class="inlinecode"><span class="id" type="var">sorted</span></span>, we can define what does being correct for a sorting algorithm mean:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Inductive</span> <a name="Sorting_correct"><span class="id" type="inductive">Sorting_correct</span></a> (<span class="id" type="var">algo</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) :=<br />
| <a name="sorting_correct_intro"><span class="id" type="constructor">sorting_correct_intro</span></a> :<br />
    (<span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<span class="id" type="var">algo</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<span class="id" type="var">algo</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>)) → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" type="inductive">Sorting_correct</span></a> <span class="id" type="var">algo</span>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Note that in both definition of <span class="inlinecode"><span class="id" type="var">sorted</span></span> and <span class="inlinecode"><span class="id" type="var">Sorting_correct</span></span>, we used list of nats instead of any lists of ordered elements. This is really just to make definitions and proofs simpler. Generalization may be done as an exercise.

<div class="paragraph"> </div>

Now with those definitions, we can prove our first and easiest-to-prove algorithm.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a name="lab1"></a><h2 class="section">Insertion sort</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

We define insertion sort as a right fold:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Fixpoint</span> <a name="insert"><span class="id" type="definition">insert</span></a> (<span class="id" type="var">i</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) :=<br />
  <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">with</span><br />
  | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a>     ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_x_';'_'..'_';'_x_']'"><span class="id" type="notation">[</span></a><a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_x_';'_'..'_';'_x_']'"><span class="id" type="notation">]</span></a><br />
  | <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> ⇒ <span class="id" type="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Arith.Compare_dec.html#leb"><span class="id" type="definition">leb</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <span class="id" type="var">h</span> <span class="id" type="keyword">then</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> <span class="id" type="keyword">else</span> <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" type="definition">insert</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <span class="id" type="var">t</span><br />
  <span class="id" type="keyword">end</span>.<br />

<br />
<span class="id" type="keyword">Definition</span> <a name="insertion_sort"><span class="id" type="definition">insertion_sort</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#fold_right"><span class="id" type="definition">fold_right</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" type="definition">insert</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now if we could show that <span class="inlinecode"><span class="id" type="var">insert</span></span> <span class="inlinecode"><span class="id" type="var">h</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> on list <span class="inlinecode"><span class="id" type="var">h</span></span> <span class="inlinecode">::</span> <span class="inlinecode"><span class="id" type="var">t</span></span> returns a permutation, we could easily show that insertion sort returns a permutation, because all it does is to call <span class="inlinecode"><span class="id" type="var">insert</span></span> on list elements, using <span class="inlinecode"><span class="id" type="var">fold_right</span></span>.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="insert_perm"><span class="id" type="lemma">insert_perm</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" type="definition">insert</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>) (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use <span class="inlinecode"><span class="id" type="var">insert_perm</span></span> and transitivity, symmetry and reflexivity of <span class="inlinecode"><span class="id" type="var">Permutation</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="Permutation_insertion_sort"><span class="id" type="lemma">Permutation_insertion_sort</span></a>: <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort"><span class="id" type="definition">insertion_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

To show that it returns sorted, we use a similar approach. We first show that if <span class="inlinecode"><span class="id" type="var">sorted</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span>, then <span class="inlinecode"><span class="id" type="var">sorted</span></span> <span class="inlinecode">(<span class="id" type="var">insert</span></span> <span class="inlinecode"><span class="id" type="var">e</span></span> <span class="inlinecode"><span class="id" type="var">l</span>)</span>. Empty and singleton lists are sorted by definition. Using these facts, we can easily prove that insertion sort really return sorted.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 star. You need to use some lemmas about <span class="inlinecode"><span class="id" type="var">leb</span></span> that are already included. Use <span class="inlinecode"><span class="id" type="keyword">SearchAbout</span></span> <span class="inlinecode"><span class="id" type="var">leb</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="insert_sorted_preserve"><span class="id" type="lemma">insert_sorted_preserve</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insert"><span class="id" type="definition">insert</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 star. Use <span class="inlinecode"><span class="id" type="var">insert_sorted_preserve</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="insertion_sort_sorted"><span class="id" type="lemma">insertion_sort_sorted</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort"><span class="id" type="definition">insertion_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

With permutation and sorted properties proved, we can show that our insertion sort implementation is correct:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Theorem</span> <a name="insertion_sort_correct"><span class="id" type="lemma">insertion_sort_correct</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" type="inductive">Sorting_correct</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort"><span class="id" type="definition">insertion_sort</span></a>.<br />
<span class="id" type="keyword">Proof</span>.<br />
  <span class="id" type="tactic">constructor</span>. <span class="id" type="tactic">split</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#insertion_sort_sorted"><span class="id" type="lemma">insertion_sort_sorted</span></a>. <span class="id" type="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Permutation_insertion_sort"><span class="id" type="lemma">Permutation_insertion_sort</span></a>.<br />
<span class="id" type="keyword">Qed</span>.<br />

<br />
</div>

<div class="doc">
<a name="lab2"></a><h2 class="section">Selection sort</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

Next, we move to selection sort. This one is significantly harder and most stuff we define in this section will be used in the next section.

<div class="paragraph"> </div>

Before implementing the algorithm, we need some auxiliary functions. <span class="inlinecode"><span class="id" type="var">find_min_idx</span></span> is both used in selection sort and pancake sort. As you can imagine from the name, it returns index of one of the smallest elements in a list.

<div class="paragraph"> </div>

Note that it's very very hard to reason about this definition. The reason is that we're using index of a list, instead of head/tail of it. Simple induction-based proofs that we do before simply don't work on this definition.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Fixpoint</span> <a name="find_min_idx_aux"><span class="id" type="definition">find_min_idx_aux</span></a> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) (<span class="id" type="var">min</span> <span class="id" type="var">min_idx</span> <span class="id" type="var">cur_idx</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> :=<br />
  <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">with</span><br />
  | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a>     ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" type="variable">min_idx</span></a><br />
  | <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> ⇒ <span class="id" type="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Arith.Compare_dec.html#leb"><span class="id" type="definition">leb</span></a> <span class="id" type="var">h</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min"><span class="id" type="variable">min</span></a> <span class="id" type="keyword">then</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" type="definition">find_min_idx_aux</span></a> <span class="id" type="var">t</span> <span class="id" type="var">h</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#cur_idx"><span class="id" type="variable">cur_idx</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#cur_idx"><span class="id" type="variable">cur_idx</span></a>)<br />
                           <span class="id" type="keyword">else</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" type="definition">find_min_idx_aux</span></a> <span class="id" type="var">t</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min"><span class="id" type="variable">min</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" type="variable">min_idx</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#cur_idx"><span class="id" type="variable">cur_idx</span></a>)<br />
  <span class="id" type="keyword">end</span>.<br />

<br />
<span class="id" type="keyword">Definition</span> <a name="find_min_idx"><span class="id" type="definition">find_min_idx</span></a> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> :=<br />
  <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">with</span><br />
  | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a>     ⇒ 0<br />
  | <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" type="definition">find_min_idx_aux</span></a> <span class="id" type="var">t</span> <span class="id" type="var">h</span> 0 1<br />
  <span class="id" type="keyword">end</span>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

An invariant of <span class="inlinecode"><span class="id" type="var">find_min_idx</span></span>:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="find_min_idx_len_inv"><span class="id" type="lemma">find_min_idx_len_inv</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span> <span class="id" type="var">m</span> <span class="id" type="var">mi</span> <span class="id" type="var">ci</span> <span class="id" type="var">r</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" type="definition">find_min_idx_aux</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#m"><span class="id" type="variable">m</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#mi"><span class="id" type="variable">mi</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#ci"><span class="id" type="variable">ci</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#r"><span class="id" type="variable">r</span></a> →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#mi"><span class="id" type="variable">mi</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;'_x"><span class="id" type="notation">&lt;</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#ci"><span class="id" type="variable">ci</span></a> →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#r"><span class="id" type="variable">r</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;'_x"><span class="id" type="notation">&lt;</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#ci"><span class="id" type="variable">ci</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'+'_x"><span class="id" type="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Make sure you understand what it's saying. We need this lemma to eliminate some impossible cases in proofs.

<div class="paragraph"> </div>

We also need a &quot;membership&quot; predicate. This is used to express the idea of &quot;for all elements in the list ...&quot;, which is expressed in Coq like <span class="inlinecode"><span class="id" type="keyword">∀</span></span> <span class="inlinecode"><span class="id" type="var">e</span>,</span> <span class="inlinecode"><span class="id" type="var">member</span></span> <span class="inlinecode"><span class="id" type="var">e</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span> <span class="inlinecode">→</span> <span class="inlinecode">...</span>.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Inductive</span> <a name="member"><span class="id" type="inductive">member</span></a> {<span class="id" type="var">A</span>} : <span class="id" type="var">A</span> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <span class="id" type="var">A</span> → <span class="id" type="keyword">Prop</span> :=<br />
| <a name="Member_head"><span class="id" type="constructor">Member_head</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>)<br />
| <a name="Member_tail"><span class="id" type="constructor">Member_tail</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">e</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Again, convince yourself that this really expresses that idea. Here's a property of member:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="member_preserved_by_perm"><span class="id" type="lemma">member_preserved_by_perm</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">A</span> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) <span class="id" type="var">l'</span> <span class="id" type="var">e</span>,<br />
  <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a> →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now using <span class="inlinecode"><span class="id" type="var">member</span></span>, we can express correctness of <span class="inlinecode"><span class="id" type="var">find_min_idx</span></span> and prove it. Note that this is a very hard exercise. I couldn't solve it for a week, and even after that period I couldn't solve it without help from Coq IRC channel. Feel free to cheat by looking the source of this post.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
</div>

<div class="doc">
***** Exercise: 5 stars. <span class="inlinecode"><span class="id" type="var">find_min_idx</span></span> really returns index of smallest element. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="find_min_idx_correct"><span class="id" type="lemma">find_min_idx_correct</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx"><span class="id" type="definition">find_min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> →<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#nth"><span class="id" type="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now, in selection sort, we run several operations on argument. One of them is <span class="inlinecode"><span class="id" type="var">find_min_idx</span></span> which we already defined. Another one of them is <span class="inlinecode"><span class="id" type="tactic">replace</span></span> operation, which replaces nth element in a list with given element. Here's a definition and some properties:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Fixpoint</span> <a name="replace"><span class="id" type="definition">replace</span></a> {<span class="id" type="var">A</span>} (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">idx</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) (<span class="id" type="var">e</span> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a> :=<br />
  <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">with</span><br />
  | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a><br />
  | <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> ⇒<br />
      <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#idx"><span class="id" type="variable">idx</span></a> <span class="id" type="keyword">with</span><br />
      | 0 ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span><br />
      | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <span class="id" type="var">idx'</span> ⇒ <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" type="definition">replace</span></a> <span class="id" type="var">t</span> <span class="id" type="var">idx'</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a><br />
      <span class="id" type="keyword">end</span><br />
  <span class="id" type="keyword">end</span>.<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. First part of correctness proof of <span class="inlinecode"><span class="id" type="tactic">replace</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="replace_nth"><span class="id" type="lemma">replace_nth</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span> <span class="id" type="var">e</span> <span class="id" type="var">l'</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;'_x"><span class="id" type="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" type="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a> →<br />
  <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#nth"><span class="id" type="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a>.<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. Second part of correctness proof of <span class="inlinecode"><span class="id" type="tactic">replace</span></span>. <span class="inlinecode"><span class="id" type="tactic">replace</span></span> preserves length of the list. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="replace_len"><span class="id" type="lemma">replace_len</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">A</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span> (<span class="id" type="var">e</span> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>),<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;'_x"><span class="id" type="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> →<br />
  <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" type="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Using <span class="inlinecode"><span class="id" type="tactic">replace</span></span>, we can define <span class="inlinecode"><span class="id" type="var">selection_sort</span></span>. Note that our naive implementation doesn't convince Coq that it terminates on all input. An easy workaround is to add a <span class="inlinecode"><span class="id" type="var">step</span></span> parameter. Observing that selection sort algorithm terminates in <span class="inlinecode"><span class="id" type="var">length</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span> steps, where <span class="inlinecode"><span class="id" type="var">l</span></span> is the input, we can define this:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Fixpoint</span> <a name="selection_sort_aux"><span class="id" type="definition">selection_sort_aux</span></a> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) (<span class="id" type="var">step</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> :=<br />
  <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#step"><span class="id" type="variable">step</span></a> <span class="id" type="keyword">with</span><br />
  | 0       ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a><br />
  | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <span class="id" type="var">step'</span> ⇒<br />
      <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">with</span><br />
      | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a>     ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a><br />
      | <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> ⇒<br />
          <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx_aux"><span class="id" type="definition">find_min_idx_aux</span></a> <span class="id" type="var">t</span> <span class="id" type="var">h</span> 0 1 <span class="id" type="keyword">with</span><br />
          | 0     ⇒ <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort_aux"><span class="id" type="definition">selection_sort_aux</span></a> <span class="id" type="var">t</span> <span class="id" type="var">step'</span><br />
          | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <span class="id" type="var">min</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#nth"><span class="id" type="definition">nth</span></a> <span class="id" type="var">min</span> <span class="id" type="var">t</span> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort_aux"><span class="id" type="definition">selection_sort_aux</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" type="definition">replace</span></a> <span class="id" type="var">t</span> <span class="id" type="var">min</span> <span class="id" type="var">h</span>) <span class="id" type="var">step'</span><br />
          <span class="id" type="keyword">end</span><br />
      <span class="id" type="keyword">end</span><br />
  <span class="id" type="keyword">end</span>.<br />

<br />
<span class="id" type="keyword">Definition</span> <a name="selection_sort"><span class="id" type="definition">selection_sort</span></a> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> := <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort_aux"><span class="id" type="definition">selection_sort_aux</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

We have all we need to prove permutation property. It's still not easy though. I'm putting an extra lemma here as a tip.

</div>
<div class="code">

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="replace_perm_head"><span class="id" type="lemma">replace_perm_head</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">n</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;'_x"><span class="id" type="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> →<br />
  <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#nth"><span class="id" type="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" type="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 3 stars. Use <span class="inlinecode"><span class="id" type="var">replace_perm_head</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="Permutation_selection_sort"><span class="id" type="lemma">Permutation_selection_sort</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort"><span class="id" type="definition">selection_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Proving sorted property is again, not easy. I'm putting some lemmas as pointers. Lemmas are very easy to prove, leaving only the master theorem as a challange.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="member_replace"><span class="id" type="lemma">member_replace</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">A</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span> (<span class="id" type="var">x</span> <span class="id" type="var">y</span> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>),<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" type="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#y"><span class="id" type="variable">y</span></a>) →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#y"><span class="id" type="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'\/'_x"><span class="id" type="notation">∨</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>.<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use <span class="inlinecode"><span class="id" type="var">member_replace</span></span> and <span class="inlinecode"><span class="id" type="var">find_min_idx_correct</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="swap_min_replace"><span class="id" type="lemma">swap_min_replace</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span> <span class="id" type="var">min_idx</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx"><span class="id" type="definition">find_min_idx</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" type="variable">min_idx</span></a> →<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#replace"><span class="id" type="definition">replace</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" type="variable">min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a>) → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#nth"><span class="id" type="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" type="variable">min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="sorted_min_tail"><span class="id" type="lemma">sorted_min_tail</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> →<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a>) →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use <span class="inlinecode"><span class="id" type="var">member_preserved_by_perm</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="min_preserved_by_perm"><span class="id" type="lemma">min_preserved_by_perm</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">m</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>,<br />
  <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a> →<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#m"><span class="id" type="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a>) →<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">e</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#m"><span class="id" type="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 4 stars. Selection sort returns sorted. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="selection_sort_sorted"><span class="id" type="lemma">selection_sort_sorted</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort"><span class="id" type="definition">selection_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. Show that selection sort is correct. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="selection_sort_correct"><span class="id" type="lemma">selection_sort_correct</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" type="inductive">Sorting_correct</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#selection_sort"><span class="id" type="definition">selection_sort</span></a>.<br />

<br />
</div>

<div class="doc">
<a name="lab3"></a><h2 class="section">Pancake sort</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

This is getting harder and harder. We'll define pancake sort in terms of <span class="inlinecode"><span class="id" type="var">rev_at</span></span> which reverses a list at given index and <span class="inlinecode"><span class="id" type="var">map_rest</span></span> which is like <span class="inlinecode"><span class="id" type="var">map</span></span>, but applies the function to the rest of the list.

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Fixpoint</span> <a name="rev_at"><span class="id" type="definition">rev_at</span></a> {<span class="id" type="var">A</span>} <span class="id" type="var">idx</span> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a> :=<br />
  <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#idx"><span class="id" type="variable">idx</span></a> <span class="id" type="keyword">with</span><br />
  | 0      ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#rev"><span class="id" type="definition">rev</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a><br />
  | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <span class="id" type="var">idx'</span> ⇒<br />
      <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">with</span><br />
      | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a>     ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a><br />
      | <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> ⇒ <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" type="definition">rev_at</span></a> <span class="id" type="var">idx'</span> <span class="id" type="var">t</span><br />
      <span class="id" type="keyword">end</span><br />
  <span class="id" type="keyword">end</span>.<br />

<br />
<span class="id" type="keyword">Fixpoint</span> <a name="map_rest_aux"><span class="id" type="definition">map_rest_aux</span></a> {<span class="id" type="var">A</span>} (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">f</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">timeout</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a> :=<br />
  <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#timeout"><span class="id" type="variable">timeout</span></a> <span class="id" type="keyword">with</span><br />
  | 0 ⇒ <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a><br />
  | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#S"><span class="id" type="constructor">S</span></a> <span class="id" type="var">timeout'</span> ⇒<br />
      <span class="id" type="keyword">match</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" type="variable">f</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">with</span><br />
      | <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#ListNotations.:list_scope:'['_']'"><span class="id" type="notation">[]</span></a><br />
      | <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <span class="id" type="var">t</span> ⇒ <span class="id" type="var">h</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest_aux"><span class="id" type="definition">map_rest_aux</span></a> <span class="id" type="var">t</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" type="variable">f</span></a> <span class="id" type="var">timeout'</span><br />
      <span class="id" type="keyword">end</span><br />
  <span class="id" type="keyword">end</span>.<br />

<br />
<span class="id" type="keyword">Definition</span> <a name="map_rest"><span class="id" type="definition">map_rest</span></a> {<span class="id" type="var">A</span>} (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">f</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a> :=<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest_aux"><span class="id" type="definition">map_rest_aux</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" type="variable">f</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Two things to note: 1) <span class="inlinecode"><span class="id" type="var">rev_at</span></span> returns the original list if <span class="inlinecode"><span class="id" type="var">idx</span></span> is larger than <span class="inlinecode"><span class="id" type="var">length</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span> <span class="inlinecode">-</span> <span class="inlinecode">1</span>. 2) <span class="inlinecode"><span class="id" type="var">map_rest</span></span> only works as expected if <span class="inlinecode"><span class="id" type="var">f</span></span> preserves length of it's argument in it's return value.

<div class="paragraph"> </div>

There's a very useful property that we need to show before showing that pancake sort returns a permutation: if <span class="inlinecode"><span class="id" type="var">f</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span> returns a permutation, than <span class="inlinecode"><span class="id" type="var">map_rest</span></span> <span class="inlinecode"><span class="id" type="var">l</span></span> <span class="inlinecode"><span class="id" type="var">f</span></span> returns a permutation:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 stars. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="Permutation_map_rest"><span class="id" type="lemma">Permutation_map_rest</span></a> :<br />
  <span class="id" type="keyword">∀</span> <span class="id" type="var">A</span> (<span class="id" type="var">f</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a> → <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>),<br />
  (<span class="id" type="keyword">∀</span> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" type="variable">f</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>)) →<br />
  (<span class="id" type="keyword">∀</span> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest"><span class="id" type="definition">map_rest</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#f"><span class="id" type="variable">f</span></a>)).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Using this definition we can define pancake sort:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Definition</span> <a name="flip_pancakes"><span class="id" type="definition">flip_pancakes</span></a> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> :=<br />
  <span class="id" type="keyword">let</span> <span class="id" type="var">min_idx</span> := <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#find_min_idx"><span class="id" type="definition">find_min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <span class="id" type="keyword">in</span><br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" type="definition">rev_at</span></a> 0 (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" type="definition">rev_at</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#min_idx"><span class="id" type="variable">min_idx</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
<span class="id" type="keyword">Definition</span> <a name="pancake_sort"><span class="id" type="definition">pancake_sort</span></a> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" type="inductive">nat</span></a> := <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#map_rest"><span class="id" type="definition">map_rest</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" type="definition">flip_pancakes</span></a>.<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Showing permutation property is actually very easy. All we need is two simple lemmas:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 stars. Use already included standard permutation lemmas. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="Permutation_rev_at"><span class="id" type="lemma">Permutation_rev_at</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">A</span> <span class="id" type="var">n</span> (<span class="id" type="var">l</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#A"><span class="id" type="variable">A</span></a>),<br />
  <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" type="definition">rev_at</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 2 stars. Use transitivity of permutation and <span class="inlinecode"><span class="id" type="var">Permutation_rev_at</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="Permutation_flip_pancakes"><span class="id" type="lemma">Permutation_flip_pancakes</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" type="definition">flip_pancakes</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. Use <span class="inlinecode"><span class="id" type="var">Permutation_flip_pancakes</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="Permutation_pancake_sort"><span class="id" type="lemma">Permutation_pancake_sort</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sort"><span class="id" type="definition">pancake_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

Now the hard part. I needed a lot of lemmas for showing sorted property. I'm listing lemmas I used in no particular order.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

 ***** Exercise: 2 stars. Smallest element is still smallest in a permutation. I found this a bit tricky. You may need to use another lemma we defined. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="min_permutation"><span class="id" type="lemma">min_permutation</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>,<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">e'</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e'"><span class="id" type="variable">e'</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e'"><span class="id" type="variable">e'</span></a>) →<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">l'</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Sorting.Permutation.html#Permutation"><span class="id" type="inductive">Permutation</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a> →<br />
    (<span class="id" type="keyword">∀</span> <span class="id" type="var">e'</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e'"><span class="id" type="variable">e'</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l'"><span class="id" type="variable">l'</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e"><span class="id" type="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e'"><span class="id" type="variable">e'</span></a>)).<br />

<br />
</div>

<div class="doc">
***** Exercise: 1 star. <span class="inlinecode"><span class="id" type="var">flip_pancakes</span></span> preserves the length. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="flip_pancakes_len"><span class="id" type="lemma">flip_pancakes_len</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" type="definition">flip_pancakes</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />

<br />
</div>

<div class="doc">
***** Exercise: 4 stars. We can use <span class="inlinecode"><span class="id" type="var">rev_at</span></span> to move smallest element to the end of the list, and then to the beginning of the list. Very tricky. Feel free to cheat. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="rev_at_n"><span class="id" type="lemma">rev_at_n</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;'_x"><span class="id" type="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#length"><span class="id" type="definition">length</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" type="definition">rev_at</span></a> 0 (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#rev_at"><span class="id" type="definition">rev_at</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t"><span class="id" type="variable">t</span></a> →<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h"><span class="id" type="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Lists.List.html#nth"><span class="id" type="definition">nth</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#n"><span class="id" type="variable">n</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> 0.<br />

<br />

<br />
</div>

<div class="doc">
***** Exercise: 3 stars. <span class="inlinecode"><span class="id" type="var">flip_pancakes</span></span> moves smallest element to the head of the list. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="flip_pancakes_min"><span class="id" type="lemma">flip_pancakes_min</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span> <span class="id" type="var">h'</span> <span class="id" type="var">t'</span>,<br />
  <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#flip_pancakes"><span class="id" type="definition">flip_pancakes</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h'"><span class="id" type="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t'"><span class="id" type="variable">t'</span></a> →<br />
  (<span class="id" type="keyword">∀</span> <span class="id" type="var">e'</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#member"><span class="id" type="inductive">member</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e'"><span class="id" type="variable">e'</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#t'"><span class="id" type="variable">t'</span></a> → <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#h'"><span class="id" type="variable">h'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Peano.html#:nat_scope:x_'&lt;='_x"><span class="id" type="notation">≤</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#e'"><span class="id" type="variable">e'</span></a>).<br />

<br />
</div>

<div class="doc">
***** Exercise: 4 stars. You need a lot of lemmas we defined before, and it's a very long proof. Still not as hard as <span class="inlinecode"><span class="id" type="var">find_min_idx_correct</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Theorem</span> <a name="pancake_sorted"><span class="id" type="lemma">pancake_sorted</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">l</span>, <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#sorted"><span class="id" type="inductive">sorted</span></a> (<a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sort"><span class="id" type="definition">pancake_sort</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#l"><span class="id" type="variable">l</span></a>).<br />

<br />
</div>

<div class="doc">

<div class="paragraph"> </div>

And finally, our master theorem:

<div class="paragraph"> </div>


</div>
<div class="code">

<br />
<span class="id" type="keyword">Theorem</span> <a name="pancake_sort_correct"><span class="id" type="lemma">pancake_sort_correct</span></a> : <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Sorting_correct"><span class="id" type="inductive">Sorting_correct</span></a> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sort"><span class="id" type="definition">pancake_sort</span></a>.<br />
<span class="id" type="keyword">Proof</span>.<br />
  <span class="id" type="tactic">constructor</span>. <span class="id" type="tactic">intro</span>. <span class="id" type="tactic">split</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#pancake_sorted"><span class="id" type="lemma">pancake_sorted</span></a>. <span class="id" type="tactic">apply</span> <a class="idref" href="../posts/2014-09-08-proving-sorting-correct.html#Permutation_pancake_sort"><span class="id" type="lemma">Permutation_pancake_sort</span></a>.<br />
<span class="id" type="keyword">Qed</span>.<br />

<br />
</div>

<div class="doc">
<a name="lab4"></a><h2 class="section">Notes and lessons learned</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

Implementation of algorithms are not what you'd expect to have in an imperative language. Rather than mutable arrays with O(1) access, I used classic functional style, using persistent linked lists. While that doesn't affect runtime asymptotic complexities of sorting algorithms I used, it causes a lot of redundant allocations and worse iteration performance. Even the OCaml/Haskell extractions are not usable.

<div class="paragraph"> </div>

Still, proving on those purely functional definitions were very hard. The reason is that once you move away from basic &quot;induction of subterm&quot; style proofs, proving gets very hard very fast. Specifically, I found working on indexes and accumulators very hard.

<div class="paragraph"> </div>

As a next step, I'm hoping to define an imperative language in Coq, like IMP of Software Foundations but with mutable arrays, and prove same algorithms defined in that language correct.

<div class="paragraph"> </div>


</div>
<div class="code">
</div>


<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'osa1'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

            </div>
        </div>
    </body>
</html>
